<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Source: index.js | Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">


</head>

<body>
    <nav class="lnb" id="lnb">
        <div class="logo" style="width: 100px; height: 100px">

            <a href="https://github.com/BHC-IT/dosismart" rel="noopener noreferrer" target="_blank">
                <img src="https://zupimages.net/up/20/07/hhfh.png" width="100%" height="100%">
            </a>

        </div>
        <div class="title">
            <h1><a href="index.html" class="link">Source: index.js</a></h1>

        </div>
        <div class="search-container" id="search-container">
            <input type="text" placeholder="Search">
            <ul></ul>
        </div>

        <div class="lnb-api hidden">
            <h3>Modules</h3>
            <ul>
                <li><a href="module-./DBModels_calculsDBHelpers.html">./DBModels/calculsDBHelpers</a><button
                        type="button" class="hidden toggle-subnav btn btn-link"> <span
                            class="glyphicon glyphicon-plus"></span></button>
                    <div class="hidden" id="module:./DBModels/calculsDBHelpers_sub">
                        <div class="member-type">Methods</div>
                        <ul class="inner">
                            <li><a href="module-./DBModels_calculsDBHelpers.html#~createCalcul">createCalcul</a></li>
                            <li><a href="module-./DBModels_calculsDBHelpers.html#~defaulter">defaulter</a></li>
                            <li><a href="module-./DBModels_calculsDBHelpers.html#~defaulterCalcul">defaulterCalcul</a>
                            </li>
                            <li><a href="module-./DBModels_calculsDBHelpers.html#~getCalculById">getCalculById</a></li>
                            <li><a href="module-./DBModels_calculsDBHelpers.html#~getCalculsByIds">getCalculsByIds</a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li><a href="module-./DBModels_userDBHelpers.html">./DBModels/userDBHelpers</a><button type="button"
                        class="hidden toggle-subnav btn btn-link"> <span
                            class="glyphicon glyphicon-plus"></span></button>
                    <div class="hidden" id="module:./DBModels/userDBHelpers_sub">
                        <div class="member-type">Methods</div>
                        <ul class="inner">
                            <li><a href="module-./DBModels_userDBHelpers.html#~addCaculInHistory">addCaculInHistory</a>
                            </li>
                            <li><a href="module-./DBModels_userDBHelpers.html#~checkToken">checkToken</a></li>
                            <li><a href="module-./DBModels_userDBHelpers.html#~createUser">createUser</a></li>
                            <li><a href="module-./DBModels_userDBHelpers.html#~defaulter">defaulter</a></li>
                            <li><a href="module-./DBModels_userDBHelpers.html#~defaulterUser">defaulterUser</a></li>
                            <li><a href="module-./DBModels_userDBHelpers.html#~getUserById">getUserById</a></li>
                            <li><a href="module-./DBModels_userDBHelpers.html#~updateUserById">updateUserById</a></li>
                        </ul>
                    </div>
                </li>
                <li><a href="module-helpers_MongoConnection.html">helpers/MongoConnection</a><button type="button"
                        class="hidden toggle-subnav btn btn-link"> <span
                            class="glyphicon glyphicon-plus"></span></button>
                    <div class="hidden" id="module:helpers/MongoConnection_sub">
                        <div class="member-type">Methods</div>
                        <ul class="inner">
                            <li><a href="module-helpers_MongoConnection.html#~init">init</a></li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
        <div class="lnb-api hidden">
            <h3>Global</h3>
            <ul>
                <li><a href="global.html#main">main</a></li>
            </ul>
        </div>
    </nav>
    <div id="resizer"></div>

    <div class="main" id="main">





        <section>
            <article>
                <pre class="prettyprint source linenums"><code>// Environment Variables loading
const dotenv = require('dotenv').config();

if (dotenv.error) {
	throw dotenv.error;
}

global.XMLHttpRequest = require("xmlhttprequest").XMLHttpRequest;

const mongo = require('./Helpers/MongoLocalIniter');

const cors = require('cors');

const express = require('express');

require = require("@std/esm")(module);

const bhcAuth = require('./Helpers/bhcAPIConnector');

const expressApp = express();

const userDBhelper = require('./DBModels/userDBHelpers')(mongo, bhcAuth);

const calculDBhelper = require('./DBModels/calculsDBHelpers')(mongo);

const wallDBhelper = require('./DBModels/wallDBHelpers')(mongo);

const radioNucleideDBhelper = require('./DBModels/radioNucleideDBHelpers')(mongo);

const coefDBhelper = require('./DBModels/coefsDBHelpers')(mongo);

const bodyParser = require('body-parser');

const TCP = require('./Helpers/CppBridge');

expressApp.use(cors());

expressApp.use(bodyParser.urlencoded({ extended: true }));
expressApp.use(bodyParser.json());

const MainRoutesMethods = require('./Methods/MainRoutesMethods')(userDBhelper, calculDBhelper, bhcAuth);
const MainRouter = require('./Routers/MainRouter')(express.Router(), MainRoutesMethods);

const PhysicsRoutesMethods = require('./Methods/PhysicsRoutesMethods')(userDBhelper, calculDBhelper, bhcAuth);
const PhysicsRouter = require('./Routers/PhysicsRouter')(express.Router(), PhysicsRoutesMethods);

expressApp.use('/main', MainRouter);
expressApp.use('/physics', PhysicsRouter);


/**
 * Main function, Bridge entry point
 * 
 * @async
 * @function main
 */
async function main() {
	expressApp.listen(process.env.BRIDGE_PORT, async () => {
		console.log(`listening on port ${process.env.BRIDGE_PORT}`);
	});
}

// to use for preloading a collection in mongodatabase
mongo.init(process.env.MONGO_DB).then(() => main()).catch(e => console.log('error while connecting to mongo:', e));

//meanwhile use :
// main();

// async function test_main_cpp() {
// 	sock = new TCP();
// 	await sock.connect(process.env.DOSI_HOST, process.env.DOSI_PORT);
// 	let tmp = await sock.send(300, JSON.stringify({
// 		data: {
// 			activ: 1,
// 			src: 'Co60',
// 			distance: 1,
// 			walls: [{
// 				material: 'Water',
// 				x: 1
// 			}]
// 		}
// 	}));
// 	let resp = JSON.parse(tmp);
// 	console.log("resp", resp);
// }

// Check communication with DosismartCPP
sock = new TCP();
console.log("testing cpp");
sock.connect(process.env.DOSI_HOST, process.env.DOSI_PORT).then(async (res) => {
	let rand_nb = Math.random();
	let tmp = await sock.send(200, JSON.stringify({ ping: `${rand_nb}` }));
	let resp = JSON.parse(tmp);
	resp.ping = parseFloat(resp.ping);
	console.log("c++ connected =", rand_nb === resp.ping);
	if (rand_nb !== resp.ping) {
		throw new Error("C++ is not connected");
	}
	// test_main_cpp(sock);

}).catch(e => {
	console.log(e);
	return process.exit(22);
});
</code></pre>
            </article>
        </section>




    </div>

    <footer>
        <img class="logo" src="https://zupimages.net/up/20/07/hhfh.png" style="width: 100px; height: 100px">
        <div class="footer-text">Dosismart BridgeJS Documentation</div>
    </footer>
    <script>prettyPrint();</script>
    <script src="scripts/jquery.min.js"></script>
    <script src="scripts/tui-doc.js"></script>
    <script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>

</html>